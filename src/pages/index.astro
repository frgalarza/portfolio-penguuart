---
import cloudinary from '../lib/cloudinary';
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';

const { resources } = await cloudinary.search
  .expression('folder:Comisiones/*') 
  .sort_by('public_id', 'desc')
  .max_results(100)
  .execute();

interface Resource {
  secure_url: string;
  public_id: string;
  format: string;
}

interface Emote {
  url: string;
  id: string;
  format: string;
}

const todosLosEmotes = resources.map((image : Resource) => ({
  url: image.secure_url,
  id: image.public_id,
  format: image.format
}));
---

<Layout>
    <header class="flex flex-col items-center justify-center pt-16 pb-12 px-4">
		<div class="flex items-center gap-4 md:gap-6">
			<div class="w-20 h-20 md:w-28 md:h-28 rounded-full border-4 border-pink-400 p-1 bg-white shadow-md overflow-hidden animate-bounce-slow flex-shrink-0">
				<Image
					src="/penguu icono.png"
					alt="PenguuArt Logo"
					width={150}
					height={150}
					class="w-full h-full object-cover rounded-full"
				/>
			</div>
			<h1 class="text-5xl md:text-7xl font-extrabold text-pink-500 tracking-tight drop-shadow-sm">
				PenguuArt
			</h1>
		</div>
		
		<div class="mt-10 text-center animate-fade-in">
			<p class="text-pink-400 font-medium text-lg italic tracking-wide">
				Echá un vistazo a mis comisiones
			</p>
			<div class="mt-4 flex justify-center">
				<div class="animate-bounce bg-pink-100 p-2 rounded-full">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
					</svg>
				</div>
			</div>
		</div>
	</header>

    <section class="max-w-6xl mx-auto p-6 bg-pink-50/30 rounded-3xl mb-20 shadow-inner">
        <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-4">
            {todosLosEmotes.map((emote : Emote, index: number) => (
                <button 
                    class="emote-card aspect-square bg-white rounded-xl overflow-hidden border-2 border-pink-100 hover:border-pink-400 transition-all cursor-pointer group shadow-sm hover:shadow-md"
                    data-url={emote.url}
                >
                    <img 
                        src={emote.url} 
                        alt={`Comisión ${index + 1}`}
                        class="w-full h-full object-contain p-2 group-hover:scale-110 transition-transform"
                        loading="lazy"
                    />
                </button>
            ))}
        </div>
    </section>

    <dialog id="emote-modal" class="backdrop:bg-pink-900/40 backdrop:backdrop-blur-sm bg-transparent p-0 outline-none fixed inset-0 m-auto">
		<div class="flex flex-col items-center justify-center w-screen h-screen p-4 pointer-events-none">
			<div class="bg-white p-4 rounded-3xl border-4 border-pink-200 shadow-2xl pointer-events-auto max-w-lg w-full flex flex-col items-center">
				<img id="modal-img" src="" alt="Emote en grande" class="max-h-[60vh] object-contain mb-6" />
				<button id="close-modal" class="cursor-pointer bg-pink-500 hover:bg-pink-600 text-white px-10 py-3 rounded-full font-bold transition-all transform hover:scale-105 shadow-pink-200 shadow-lg">
					Cerrar
				</button>
			</div>
		</div>
	</dialog>

	<div class="fixed right-6 bottom-10 flex flex-col gap-4 z-50">
    <a href="https://www.instagram.com/penguu.art/?hl=es" class="bg-white p-3 rounded-full shadow-lg border-2 border-pink-100 text-pink-500 hover:bg-pink-500 hover:text-white transition-all hover:-translate-y-1">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
    </a>
    <a href="#" class="bg-white p-3 rounded-full shadow-lg border-2 border-pink-100 text-pink-500 hover:bg-pink-500 hover:text-white transition-all hover:-translate-y-1">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
    </a>
</div>
</Layout>

<style>
    /* Una animación suave para el bounce del logo */
    @keyframes bounce-slow {
        0%, 100% { transform: translateY(-5%); }
        50% { transform: translateY(0); }
    }
    .animate-bounce-slow {
        animation: bounce-slow 3s infinite;
    }

    /* Estilos para el Modal */
    dialog[open] {
        animation: zoom 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes zoom {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

	#emote-modal {
        max-width: 100vw;
        max-height: 100vh;
        border: none;
    }

    #emote-modal::backdrop {
        background: rgba(255, 182, 193, 0.4); /* Un rosa traslúcido */
        backdrop-filter: blur(4px);
    }
</style>

<script>
    const modal = document.getElementById('emote-modal') as HTMLDialogElement;
    const modalImg = document.getElementById('modal-img') as HTMLImageElement;
    const closeBtn = document.getElementById('close-modal');
    const cards = document.querySelectorAll('.emote-card');

    cards.forEach(card => {
        card.addEventListener('click', () => {
            const url = card.getAttribute('data-url');
            if (url) {
                modalImg.src = url;
                modal.showModal();
            }
        });
    });

    // Cerrar al hacer clic fuera del contenido o en el botón
    modal?.addEventListener('click', (e) => {
        if (e.target === modal) modal.close();
    });
    
    closeBtn?.addEventListener('click', () => modal.close());
</script>